<!DOCTYPE html>
<html>
  <head>
    <title>GRE For Fun</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <script src="/javascripts/jquery.min.js"></script>
    <!-- bootstrap -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" />
    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/util.js"></script>
  </head>
  <body>
    <h2>GRE For Fun</h2>
    <a href="/practice"><button type="button" class="btn btn-primary">Practice</button></a>
    <a href="/logout"><button type="button" class="btn btn-danger">Logout</button></a>
    <h4>Friend List</h4>
    <table class="table table-hover">
      <tr>
        <th class="col-md-3">Username</th>
        <th class="col-md-3">Status</th>
        <th class="col-md-3">Win / Loss</th>
        <th class="col-md-3">Invite</th>
      </tr>
      <tbody>
        <% for (var i=0; i<user.friends.length; i++) { %>
          <tr>
            <td><%= user.friends[i].username %></th>
            <td id="<%= user.friends[i].username %>">offline</td>
            <td><%= user.friends[i].play.win %> / <%= user.friends[i].play.loss %></td>
            <td>+</td>
          </tr>
        <% } %>
      </tbody>
    </table>
    <h4>Review</h4>
    <table class="table table-hover">
      <tr>
        <th class="col-md-3">Word</th>
        <th class="col-md-6">Meaning</th>
        <th class="col-md-3">Action</th>
      </tr>
      <tbody>
        <% for (var i=0; i<user.words.length; i++) { %>
          <tr>
            <td><%= user.words[i].word %></th>
            <td><%= user.words[i].meaning %></th>
            <td>-</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </body>
  <script>
    setInterval(function(){
      updateStatus(function(res){
        for (var i=0; i<res.friends.length; i++){
          if (Date.now() - res['status'][res.friends[i].username] <= 3000){
            document.getElementById(res.friends[i].username).innerHTML = 'online'
            document.getElementById(res.friends[i].username).style.color = 'green'
          } else {
            document.getElementById(res.friends[i].username).innerHTML = 'offline'
            document.getElementById(res.friends[i].username).style.color = 'black'
          }
        }
      })
    }, 3000);
  </script>
</html>
